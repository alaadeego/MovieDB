workflows:
    default-workflow:
      name: Build and Test
      max_build_duration: 15
      environment:
        flutter: stable
        xcode: latest
        cocoapods: default
      triggering:
        events:
          - pull_request
          - tag
        branch_patterns:
          - pattern: 'flutter'
            include: true
            source: false
      scripts:
        - |
          # set up debug keystore
          rm -f ~/.android/debug.keystore
          keytool -genkeypair \
            -alias androiddebugkey \
            -keypass android \
            -keystore ~/.android/debug.keystore \
            -storepass android \
            -dname 'CN=Android Debug,O=Android,C=US' \
            -keyalg 'RSA' \
            -keysize 2048 \
            -validity 10000
        - |
          # set up local properties
          echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
        - cd . && flutter packages pub get
        - cd . && flutter build apk --debug
        - find . -name "Podfile" -execdir pod install \;
        - cd . && flutter build ios --debug --no-codesign
      artifacts:
        - build/**/outputs/**/*.apk
        - build/**/outputs/**/*.aab
        - build/**/outputs/**/mapping.txt
        - build/ios/ipa/*.ipa
        - /tmp/xcodebuild_logs/*.log
        - flutter_drive.log